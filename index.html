<!DOCTYPE html>
<html>
<head>
	<meta name="description" content="ECG classification">
  <meta name="keywords" content="AI, TCN, CNN, LSTM, temporal convolutional network, semi-supervised learning, clustering, ECG, arrhythmia">
  <meta name="author" content="TomMakesThings, laviniafr, davejjwilliams, willRegen">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<!-- Website icon -->
	<link rel="shortcut icon" type="image/x-icon" href="Assets/Icon/favicon.ico">

	<!-- Tab name -->
	<title>Semi-Supervised ECG Classifier</title>

	<!-- Links to the CSS stylesheets -->
	<link rel="stylesheet" href="Stylesheets\main.css">
	<link rel="stylesheet" href="Stylesheets\figures.css">
	<link rel="stylesheet" href="Stylesheets\navbar.css">
	<link rel="stylesheet" href="Stylesheets\index.css">
	<link rel="stylesheet" href="Stylesheets\footer.css">
</head>

<body>
	<div class="header">
		<div id="header-top" onmouseover="profileHover(this);" onmouseout="profileUnhover(this);">
			<div id="header-tom">
				<div>
					<a href="https://tommakesthings.github.io/" target="_blank" style="padding: 0px 10px 0px 10px;"><img src="Assets/Images/Profile.png" alt="GitHub profile picture" class="profilepic" id="tomprofile" onmouseover="profileHover(this);" onmouseout="profileUnhover(this);"></a>
				</div>
				<div id="name-text">
					<a href="https://tommakesthings.github.io/" target="_blank" id="username" class="navtext">TomMakesThings &</a>
					<!-- <a href="https://tommakesthings.github.io/" target="_blank"><p id="hint">(click to see more of my work)</p></a> -->
				</div>
			</div>
			<div id="header-others">
				<a href="https://github.com/laviniafr" style="padding: 0px 0px 0px 15px;"><img src="https://avatars.githubusercontent.com/u/66881011?v=4" alt="GitHub profile picture" class="profilepic other-profile"></a>
				<a href="https://github.com/davejjwilliams" style="padding: 0px;"><img src="https://avatars.githubusercontent.com/u/69308846?v=4" alt="GitHub profile picture" class="profilepic other-profile"></a>
				<a href="https://github.com/willRegen" style="padding: 0px;"><img src="https://avatars.githubusercontent.com/u/50786906?v=4" alt="GitHub profile picture" class="profilepic other-profile"></a>
			</div>
		</div>
		<div id="header-center" style="margin-bottom: -20px;">
			<img src="Assets/Images/ECG-Left.png" class="ecg ecg-left">
			<img src="Assets/Images/ECG-Right.png" class="ecg ecg-right">
			<a href="https://github.com/TomMakesThings/Semi-Supervised-ECG-Classifier" target="_blank" id="sitename" class="navtext">Semi-Supervised Learning with TCNs for ECG Classification</a>
		</div>
		<div class="header-lower" id="visible-header">
			<a href="#introduction" class="navtext">Introduction</a>
			<a href="#literature" class="navtext">Literature Review</a>
			<a href="#problem" class="navtext">Problem Analysis</a>
			<a href="#implementation" class="navtext">Implementation and Evaluation</a>
			<a href="#discussions" class="navtext">Discussions and Findings</a>
		</div>
	</div>

<div class="content">
	<div>
		<a name="introduction" class="anchor"></a>
  	<h1>Introduction</h1>
		<p>The aim of this project is to create a classifier that can detect if a patient has one of several types of heart condition known as arrhythmia given a time series of an electrocardiogram (ECG) heartbeat. In particular, the focus is to use self-supervised and transfer learning to see if we can improve accuracy for two different network architectures.
		</p>

		<h2>Background</h2>
		<p>Arrhythmia is a type of heart condition concerning the rate or rhyme of the heart [1].
			The most common method of detection is through analysis of electrocardiograms (<a href="#figure1">Figure 1</a>).
			This is a test that records the electrical signals of each heartbeat [2] to produce a graph of waves and intervals such as that depicted in Figure 1.
			The most prominent waves of a healthy ECG are:
		</p>
		<ul>
			<li><span>P wave</span>: electrical activation (depolarization) of the atria by the sino-atrial node causing contraction of the upper chambers of the heart referred to as atrial systole.</li>
			<li><span>QRS complex</span>: electrical stimulation of the ventricles leading to contraction of the lower chambers of the   heart, i.e., ventricular systole.</li>
			<li><span>T wave</span>: repolarization of the ventricles allowing the muscles of the heart’s chambers to relax.</li>
		</ul>
		<p>Traditionally, arrhythmia was diagnosed by a person who analyses an ECG for identifiable traits such as irregularly shaped waves.
			However, this is often time consuming, prone to error and requires specialist training [3].
			Therefore, the development of reliable classification models is of great benefit to medical staff and the well being of patients by improving the accuracy speed of diagnosis.
		</p>

		<a name="figure1"></a>
		<figure>
			<p><img class="ecg-diagram diagram" src="Assets/Images/ECG-Diagram.png"></p>
			<figcaption><span>Figure 1:</span> ECG of a normal heartbeat [6]</figcaption>
		</figure>

		<br>

		<h2>Objectives</h2>
		<ol>
			<li>Explore the problem background, review literature and previous work on self-supervised learning, ECG classification and transfer learning</li>
			<li>Select clustering algorithms and network architecture</li>
			<li>Open and evaluate the selected dataset</li>
			<li>Perform data augmentation such as adding Gaussian noise to less frequent samples</li>
			<li>Applying clustering, determine the best result and save the cluster assignments as labels</li>
			<li>Implement a neural network and train to detect hidden features within the ECGs using the new labels</li>
			<li>Transfer the weights of the trained network to a new model and train for classification using the arrhythmia labels</li>
			<li>Optimize the chosen model</li>
			<li>Compare the model to a classifier with the same architecture without transferred weights</li>
			<li>Present results and evaluate findings</li>
			<li>Suggest future recommendations</li>
		</ol>

		<br>

	</div>

	<div>
		<a name="literature" class="anchor"></a>
		<h1>Literature Review</h2>
		<h2>Network Architectures</h2>
		<h3>Convolution Neural Networks (CNN)</h3>
		<p>CNNs are deep neural networks consisting of convolutional, pooling and fully-connected layers.
			Initially low-level features are extracted, which are then used to form higher level features. Although they are most frequently used for image recognition, research such as that by J. Li et al. has shown that they can be successfully applied to classifying arrhythmia [8].
			ECGs contain a one-dimensional signal, while CNNs are better suited to data with multiple dimensions.
			Therefore, they created a two-dimensional vector out of the rhythm and morphology of the heartbeats to feed into the model.
			This achieved a high accuracy of 99.1% for five of eight categories.
			However, it should be noted that the extensive pre-processing and experimentation detailed in this study is out of scope for this project.
		</p>

		<h3>Temporal convolutional networks (TCN)</h3>
		<p>TCNs are derived from CNNs and are a new breakthrough proposed in 2016 to process time-series information.
			The combination between casual convolutions, which prevent information leakage from the future to present, and diluted convolutions been shown to outperform recurrent nets such as LSTM in a vast range of tasks [17].
		</p>

		<h3>Long Short-Term Memory (LSTM)</h3>
		<p>LSTM is an extension of recurrent neural networks (RNN) with the addition of special units composed of a memory cell and input, output and forget gates.
			This architecture is capable of long-term pattern recognition unlike RNN.
			However, it is slower to train and requires more computational resources.
			In research by Singh et al. [7], three types of RNN were implemented with the goal of producing an accurate model for classifying arrhythmia from ECG time series.
			They explain that as CNN limits beats to a fixed length, the performance of RNN is more effective.
			The study’s results show that using LSTM rather than RNN with the same parameters increased accuracy from 85.4% to 88.1%.
		</p>

		<h3>Self-Attention</h3>
		<p>Attention is a technique that increases focus on important data while decreasing focus on less important data.
			This allows the network to devote more computing power to a small amount of important data.
			Though frequently associated with NLP and transformers, several studies have shown promising results using self-attention for time-series [18].
		</p>

		<br>

		<h2>Semi-Supervised Learning</h2>
		<p>In a study by Sarkar et al., a semi-supervised approach is adapted for ECG emotion recognition [19].
			This involved generating labels from augmented samples to train a CNN.
			The weights of the model were then transferred to a new model with the same architecture and all layers frozen except the output.
			Then the model was trained on labelled ECG data for emotion recognition achieving state of the art results in four categories.
			Other benefits of this approach include learning generalized features which can be used for a wide range of tasks, not just emotion recognition.
			Larger datasets may also be used as self-supervised learning doesn’t need annotated labels which are costly to produce.
		</p>

		<br>

		<h2>Unsupervised Learning Algorithms</h2>
		<p>Unsupervised learning is a machine learning approach in which a model must determine patterns to classify unlabeled data.
			For this project, we intend to use clustering to create labels representing hidden features of ECG data.
			Three different types of clustering algorithms will be investigated: partitional, hierarchical and density-based.
		</p>

		<h3>K-Means</h3>
		<p>K-Means is an example of partitional clustering.
			It is a vector quantization algorithm that categories a set of n data samples into k clusters based purely on features found within the data.
			In the field of medicine, the manual labeling of large amounts of data is neither feasible nor cost effective as only certified medical professionals would be qualified to do so.
			Therefore, unsupervised learning techniques such as k-means have proven especially useful.
		</p>

		<h3>Agglomerative Clustering</h3>
		<p>Unlike k-means, agglomerative is a hierarchical clustering algorithm.
			The goal is to create an expanding tree of clusters, and such does not require a predefined number.
			Hierarchical algorithms can be one of two types: agglomerative or divisive.
			The main difference is their approach in creating the trees.
			Agglomerative algorithms start with one ‘cluster’ for each sample and progressively groups them based on similarities in the samples, whereas divisive starts from the top of the tree, splitting one cluster containing all samples.
		</p>

		<h3>DBSCAN</h3>
		<p>DBSCAN is a density-based clustering algorithm that groups points together based on distance and number of neighbors whilst marking points in low density regions as outliers.
			It is used to find associations and structures which are then used to find patterns and predict trends.
			DBSCAN can find randomly shaped clusters surrounded by other clusters.
		</p>

		<br>

	</div>

	<div>
		<a name="problem" class="anchor"></a>
		<h1>Problem Analysis</h1>
		<h2>Proposed Approach</h2>
		<p>For this project, we proposed to use unsupervised learning through clustering to assign new labels to all samples in a dataset of ECGs.
			CNN and bidirectional LSTM models will be trained to classify samples based upon these new labels.
			The best models will be saved, and the weights transferred to a new classifier with the same architecture as shown in <a href="#figure2">Figure 2</a>.
			All layers except the final layer are frozen and the new model trained to classify the original labels.
		</p>

		<a name="figure2"></a>
		<figure>
			<p><img class="tcn-diagram diagram" src="Assets/Images/TCN-Diagram.png"></p>
			<figcaption><span>Figure 2:</span> The proposed network architecture</figcaption>
		</figure>

		<h3>Proposed Network Architecture</h3>
		<p>The CNN is to be initially constructed with a 1D convolutional layer, max pooling, flatten layer and two fully connected layers.
			ReLU activation functions are applied between layers, followed by sigmoid for the output.
			The structure of the LSTM will be similar, though the conv and pool layers replaced by a bidirectional LSTM with 64 units.
			For both models, two additional variations of each architecture are to be tested.
			This includes either adding a TCN layer at the beginning, or a self-attention after the CNN or LSTM block.
		</p>

		<br>

		<h2>Challenges</h2>
		<h3>Measuring Clustering Performance</h3>
		<p>In the absence of a ground truth, it is difficult to measure how well each algorithm has performed.
			According to a study by Palacio-Niño et al. [16], the two types of validation metrics that are commonly combined are cohesion and separation.
			Often for partitional clustering algorithms such as k-means, a measure such as the silhouette coefficient is used, while for hierarchical algorithms the cophenetic coefficient is preferred.
			However, cohesion and separation measures often do not perform as well for density-based clustering like DBSCAN.
		</p>

		<h3>Class Imbalance</h3>
		<p>The label distribution of the dataset is largely unbalanced, with 83% of samples belonging to the non-ectopic class.
			Without either up-sampling or down-sampling, this can cause the model to converge to always predict the same class resulting in a misleadingly high accuracy as proven in <a href="#figure3">Figure 3</a>.
		</p>

		<a name="figure3"></a>
		<figure>
			<div class="aligned-images">
				<p><img class="raw-label-pie diagram" src="Assets/Images/Raw-Label-Distribution-Pie.png"></p>
				<p><img class="confusion-matrix diagram" src="Assets/Images/Raw-Label-Confusion-Matrix.png"></p>
			</div>
			<figcaption><span>Figure 3:</span> Left is the label distribution of all the data; right is a confusion matrix in which the same class if always being predicted produced when training an LSTM on all original labels</figcaption>
		</figure>

		<h3>Transfer Learning</h3>
		<p>A significant part of the project involved comparing multiple architectures and configuring parameters to achieve the best classification performance.
			However, the team was limited in how much they could modify the arrhythmia classifier’s architecture as it needed to remain compatible with the pre-trained cluster model to apply transfer learning.
			While it was necessary to augment the data due to the significant imbalance, the model’s ability to detect patterns for certain arrhythmia conditions may have been reduced due to augmented samples not reflecting real world data.
		</p>

		<br>

		<h2>Technical Issues</h2>
		<h3>Colab</h3>
		<p>Implementation was done through <a href="https://github.com/TomMakesThings/Semi-Supervised-ECG-Classifier">two shared notebooks</a> on Google Colab.
			However, there were several technical factors, which, when combined with time constraints, affected the outcome of the investigation.
			For example, long training times when adding LSTM layers, along with the large range of optimisable parameters, meant that we did not explore the LSTM architecture in as much depth as CNN and that compromises needed to be made to select reasonable parameters in the time available.
			In addition, runtime constraints sometimes caused the notebooks to disconnect upon training for a long time over many epochs.
		</p>

		<h3>Remote Working</h3>
		<p>Finally, due to the pandemic, the team faced the challenge of completing the project entirely remotely.
			This was tackled by holding online meetings twice a week, encouraging strong communication and progress checking between the team.
		</p>

		<br>

	</div>

	<div>
		<a name="implementation" class="anchor"></a>
		<h1>Implementation and Evaluation</h1>
		<h2>Dataset</h2>
		<p>For the project we used the <a href="https://www.kaggle.com/shayanfazeli/heartbeat">MIT-BIH Arrhythmia Dataset</a> [4].
			This is a popular, publicly available dataset produced in 1980 for the purpose of detecting types of arrhythmia.
			It was selected as it contains 109446 labelled samples which is sufficient to train a supervised deep neural network.
			Although each sample is assigned one of five classes, these are originally derived from 16 types of arrhythmia as outlined in <a href="#table1">Table 1</a>.
		</p>

		<a name="table1"></a>
		<figure style="margin: 0px;">
			<table>
				<thead>
	  			<tr>
	    			<th>Label</th>
	    			<th>Class Name</th>
	    			<th>Explaination</th>
						<th>Samples</th>
	  			</tr>
				</thead>
				<tbody>
					<tr>
						<td>0/N</td>
						<td>Non-ectotic beats</td>
						<td>ECGs that have been determined to have a normal heartbeat.
							The patient does not have arrhythmia.</td>
						<td>90589</td>
					</tr>
					<tr>
						<td>1/S</td>
						<td>Supraventricular ectopic beats</td>
						<td>ECGs show traits of either atrial premature beats, aberrated premature beats, nodal junction premature beats,
							or supraventricular premature beats [5].</td>
						<td>2779</td>
					</tr>
					<tr>
						<td>2/V</td>
						<td>Ventricular ectopic beats</td>
						<td>ECGs were determined as either premature ventricular contraction or ventricular escape beats [5].</td>
						<td>7236</td>
					</tr>
					<tr>
						<td>3/F</td>
						<td>Fusion beats</td>
						<td>ECGs have fusion of ventricular or fusion of normal beats [5].</td>
						<td>803</td>
					</tr>
					<tr>
						<td>4/Q</td>
						<td>Unknown beats</td>
						<td>ECGs contains a paced beat, fusion of paced and normal beats or an unclassified beat [5].</td>
						<td>8039</td>
					</tr>
				</tbody>
			</table>
			<figcaption><span>Table 1:</span> MIT-BIH dataset classes</figcaption>
		</figure>

		<br>

		<h2>Data Augmentation</h2>
		<p>Before clustering, more samples of the least frequent class are created.
			This was achieved by adding Gaussian noise to the non-padded part of the time-series, then normalizing to ensure amplitude is between 0 - 1 like the other samples (see <a href="#figure4">Figure 4</a>).
			Some of these new samples are randomly rounded to a lower number of decimal places to replicate a reduction in signal quality.
		</p>

		<a name="figure4"></a>
		<figure>
			<div class="aligned-images">
				<p><img class="original-ecg diagram" src="Assets/Images/Original-ECG.png"></p>
				<p><img class="gaussian-ecg diagram" src="Assets/Images/Gaussian-ECG.png"></p>
			</div>
			<figcaption><span>Figure 4:</span> Example of a real ECG (left) and a Gaussian noise augmented sample (right)</figcaption>
		</figure>

		<br>

		<h2>Clustering</h2>
		<p>Before training the first classification model, new labels were assigned to each sample through clustering.
			To improve the quality of the cluster assignments, we tested different parameters for the clustering algorithms.
			For each, the silhouette coefficient metric was used to quantify the closeness of samples within their respective clusters, with a larger value representing a greater success in clustering similar ECG samples.
		</p>

		<h3>K-Means and Agglomerative Clustering</h3>
		<p>For both k-means and agglomerative clustering, the number of clusters is set beforehand and so we tested different numbers of clusters.
			It is expected that a larger number of clusters would allow for a more granular and therefore more successful clustering output.
			However, an excessive number of clusters leads to each cluster containing too few samples for a classifier to effectively learn from.
			Therefore, a balance needed to be struck between the silhouette coefficient and number of clusters.
			Another factor is the evenness of distribution of samples across the clusters.
			If most samples were assigned to a single cluster, this would cause a great imbalance later when training a classifier.
			To tackle this, standard deviation of the cluster sizes was calculated and considered when selecting the final value for cluster number.
			It was decided that for both k-means and agglomerative, the number of clusters should lie between 10 and 20, and after some experimentation seen in table x, it was deemed that 19 clusters would be optimal when considering silhouette coefficient, average cluster size and standard deviation.
			Once the cluster the number was selected, applying PCA before clustering was tested to extract the most representative features.
			It was found that for both algorithms, using fewer principal components significantly improved silhouette score.
			However, this was at the cost of increasing standard deviation.
		</p>

		<h3>DBSCAN</h3>
		<p>Compared to k-means and agglomerative, DBSCAN produced very poor silhouette scores and unbalanced clusters.
			Attempting to optimize the silhouette score resulted in most samples being clustered into the same 3 to 5 clusters, and many samples not being assigned a cluster at all.
			Trying to optimize the number of samples being clustered also produced low silhouette scores.
		</p>

		<h3>Conclusion</h3>
		<p>We concluded that k-means with 15 principal components was to be chosen to assign the new labels as it is a good compromise between silhouette coefficient and standard deviation.
			<a href="#figure5">Figure 5</a> demonstrates that most clusters are well defined with an identifiable shapes, while PCA and t-SNE graphs show cluster size and how similar clusters are to one another.
			These additional figures and tables of results are in the <a href="#appendix">Appendix</a>.
		</p>

		<a name="figure5"></a>
		<figure>
			<p><img class="clustered-ecgs diagram" src="Assets/Images/Clustered-ECGs.png"></p>
			<figcaption><span>Figure 5</span>: Plots of ECGs assigned to each cluster, with the coloured line representing the average time-series</figcaption>
		</figure>

		<br>

		<h2>Cluster Classification</h2>
		<h3>Train and Test Splits</h3>
		<p>After assigning a cluster to each sample, the maximum number of samples in each class is capped at 1000 and excess samples are removed.
			Again, noise augmented samples are created to provide more examples of the rarest clusters.
			Then data is split into by reserving 2000 of the non-augmented samples for testing and using the rest for training.
			This resulted in a fairly even label distribution among both assigned clusters and true labels as presented in <a href="#figure6">Figure 6</a> and <a href="#figure7">Figure 7</a>.
			At first the models were training using 20% of the training data for validation.
			Then k-fold cross validation was run on the training data to find the best train-validation split.
		</p>

		<a name="figure6"></a>
		<figure>
			<p><img class="cluster-labels diagram" src="Assets/Images/Cluster-Label-Distribution.png"></p>
			<figcaption><span>Figure 6:</span> Size distribution of cluster labels for training and testing splits</figcaption>
		</figure>

		<a name="figure7"></a>
		<figure>
			<p><img class="arrhythmia-labels diagram" src="Assets/Images/Arrhythmia-Label-Distribution.png"></p>
			<figcaption><span>Figure 7:</span> Size distribution of arrhythmia class labels for training and testing splits</figcaption>
		</figure>

		<h3>CNN and Bidirectional LSTM</h3>
		<p>First variations of CNN and LSTM models, both with and without TCN and self-attention, were run over 50 epochs using the Adam optimizer, batch size 128 and no dropout.
			Then different learning rates, the AMSGrad variant of Adam and batch normalization were tested to see if this improved performance.
			The best result was TCN combined with CNN with 12.85% test accuracy, followed by the solo CNN with 11.1%.
			By comparison, the highest test accuracy of the LSTM was 8.6%, although it should be mentioned that we did not test parameters as extensively for this architecture as it was slow to run.
			In general, self-attention did not work well for either CNN or LSTM, while the TCN layer was detrimental to the LSTM.
		</p>

		<h3>Preventing Overfitting</h3>
		<p>When the two best models were run over 250 epochs, they achieved 97.25% and 98.15% train accuracy retrospectively (refer to <a href="#table2">Table 2</a>).
			However, both validation and training accuracy were far lower suggesting the models were overfitting.
			Therefore, we tested varying rates of dropout and found that for both models this increased testing accuracy, with the best results highlighted yellow.
		</p>

		<a name="table2"></a>
		<figure style="margin: 0px;">
			<table>
				<thead>
	  			<tr>
	    			<th>Architecture</th>
	    			<th>Dropout *</th>
	    			<th>Train Loss</th>
						<th>Validation Loss</th>
						<th>Train Accuracy</th>
						<th>Validation Accuracy</th>
						<th>Test Accuracy</th>
	  			</tr>
				</thead>
				<tbody>
					<tr>
						<td>CNN</td>
						<td>0</td>
						<td>0.0891</td>
						<td>10.7169</td>
						<td>97.35%</td>
						<td>24.37%</td>
						<td>9.35%</td>
					</tr>
					<tr>
						<td>CNN</td>
						<td>0.3</td>
						<td>0.9451</td>
						<td>6.0790</td>
						<td>65.57%</td>
						<td>20.25%</td>
						<td>9.55%</td>
					</tr>
					<tr class="highlight">
						<td>CNN</td>
						<td>0.7</td>
						<td>2.4837</td>
						<td>2.8896</td>
						<td>18.57%</td>
						<td>13.03%</td>
						<td>9.75%</td>
					</tr>
					<tr>
						<td>TCN + CNN</td>
						<td>0</td>
						<td>0.0568</td>
						<td>7.4145</td>
						<td>98.15%</td>
						<td>29.29%</td>
						<td>12.15%</td>
					</tr>
					<tr class="highlight">
						<td>TCN + CNN</td>
						<td>0.3</td>
						<td>0.6391</td>
						<td>5.1540</td>
						<td>77.56%</td>
						<td>28.23%</td>
						<td>13.05%</td>
					</tr>
					<tr>
						<td>TCN + CNN</td>
						<td>0.7</td>
						<td>2.5471</td>
						<td>2.8282</td>
						<td>17.18%</td>
						<td>12.69%</td>
						<td>9.55%</td>
					</tr>
				</tbody>
			</table>
			<figcaption><span>Table 2:</span> Testing the CNN and TCN cluster classifiers over 250 epochs with dropout.
			Highlighted are the models from each architecture with the best performance.
			* Dropout values are between 0-1, where 0 is no dropout and 1 is 100% dropout.</figcaption>
		</figure>

		<h3>Training the Optimised Models</h3>
		<p>After determining the best hyperparameters for the CNN and TCN, the models were trained over a greater number of epochs with early stopping (see <a href="#figure8">Figure 8</a>) and the state that reached the highest validation accuracy saved.
			The CNN was trained for a total of 550 epochs reaching the best validation accuracy at 506.
			By comparison, the TCN converged far quicker due to the lower dropout rate so was trained for only 150 epochs and the weights saved after 124 (see <a href="#table3">Table 3</a>).
			The final test accuracies were 13.35% and 9.45% retrospectively as reflected by the confusion matrices presented in <a href="#figure9">Figure 9</a>.
		</p>

		<a name="figure8"></a>
		<figure>
			<p><img class="classifier-train diagram" src="Assets/Images/Training-Cluster-Classifiers.png"></p>
			<figcaption><span>Figure 8:</span> Training and validation accuracy of the fully trained CNN and TCN cluster classifiers</figcaption>
		</figure>

		<a name="figure9"></a>
		<figure>
			<div class="aligned-images">
				<p><img class="confusion-matrix diagram" src="Assets/Images/TCN-Cluster-Confusion-Matrix.png"></p>
				<p><img class="confusion-matrix diagram" src="Assets/Images/CNN-Cluster-Confusion-Matrix.png"></p>
			</div>
			<figcaption><span>Figure 9:</span> Confusion matrices for CNN (left) and TCN (right)</figcaption>
		</figure>

		<br>

		<a name="table3"></a>
		<figure style="margin: 0px;">
			<table>
				<thead>
	  			<tr>
	    			<th>Architecture</th>
	    			<th>Max Epochs</th>
						<th>Best Epoch</th>
	    			<th>Train Loss</th>
						<th>Validation Loss</th>
						<th>Train Accuracy</th>
						<th>Validation Accuracy</th>
						<th>Test Accuracy</th>
	  			</tr>
				</thead>
				<tbody>
					<tr>
						<td>TCN + CNN</td>
						<td>150</td>
						<td>124</td>
						<td>1.5053</td>
						<td>3.2595</td>
						<td>50.19%</td>
						<td>25.41%</td>
						<td>13.35%</td>
					</tr>
					<tr>
						<td>CNN</td>
						<td>550</td>
						<td>506</td>
						<td>2.3957</td>
						<td>2.8868</td>
						<td>19.68%</td>
						<td>17.22%</td>
						<td>9.45%</td>
					</tr>
				</tbody>
			</table>
			<figcaption><span>Table 3:</span> Results from training the optimised cluster classifiers</figcaption>
		</figure>

		<br>

		<h2>Arrhythmia Classification</h2>
		<h3>Transfer Learning</h3>
		<p>After training the CNN and CNN + TCN to classify the clusters, the weights were saved to file and uploaded to <a href="https://github.com/TomMakesThings/Semi-Supervised-ECG-Classifier">GitHub</a>.
			New models were then made with the same architectures and weights of the pre-trained models transferred.
			For each the final layer was removed and replaced with a new fully connected layer with 5 outputs.
			This is because the previous models were designed to predict 19 cluster labels, while the new models predict the 5 labels of the original data.
			The new models were then trained over 50 epochs both with and without freezing the weights of all layers, except the output layer, and compared against the same architecture without weight transfer.
			Then the best model optimised further through testing different batch sizes and trained over 200 epochs.
			Additional tables are in the <a href="#appendix">Appendix</a>.
		</p>

		<h3>CNN Performance</h3>
		<p>Without transfer learning, the CNN achieved a decent accuracy of 91.4% (see <a href="#figure10">Figure 10</a> and <a href="#figure11">11</a>).
			However, transferring the weights of the pre-trained CNN cluster classifier was detrimental to loss and accuracy both with and without freezing the layers (refer to <a href="#table4">Table 4</a>).
			Perhaps this is because the pre-trained CNN classifier did not perform well at learning the clusters (<a href="#table3">Table 3</a>) and so this did not help the new model extract useful features.
			Therefore, we did not attempt any further optimisation of this model.
		</p>

		<a name="figure10"></a>
		<figure>
			<div class="aligned-images">
				<p><img class="confusion-matrix diagram" src="Assets/Images/TCN-Label-Confusion-Matrix.png"></p>
				<p><img class="confusion-matrix diagram" src="Assets/Images/CNN-Label-Confusion-Matrix.png"></p>
			</div>
			<figcaption><span>Figure 10:</span> Confusion matrices of the frozen layer CNN (left) and the frozen layer TCN arrhythmia classifiers</figcaption>
		</figure>

		<a name="figure11"></a>
		<figure>
			<p><img class="classifier-train diagram" src="Assets/Images/CNN-Training-Arrhythmia.png"></p>
			<figcaption><span>Figure 11:</span> Training the CNN arrhythmia classifier without transfer learning</figcaption>
		</figure>

		<br>

		<a name="table4"></a>
		<figure style="margin: 0px;">
			<table>
				<thead>
					<tr>
						<th>Architecture</th>
						<th>Epochs</th>
						<th>Freeze Layers</th>
						<th>Dropout *</th>
						<th>Batch Size</th>
						<th>Train Loss</th>
						<th>Validation Loss</th>
						<th>Train Accuracy</th>
						<th>Validation Accuracy</th>
						<th>Test Accuracy</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td>CNN</td>
						<td>50</td>
						<td>True</td>
						<td>0.7</td>
						<td>128</td>
						<td>0.3356</td>
						<td>0.2525</td>
						<td>87.01%</td>
						<td>91.01%</td>
						<td>88.5%</td>
					</tr>
					<tr>
						<td>CNN</td>
						<td>50</td>
						<td>False</td>
						<td>0.7</td>
						<td>128</td>
						<td>0.3935</td>
						<td>0.2892</td>
						<td>85.41%</td>
						<td>89.79%</td>
						<td>87.2%</td>
					</tr>
					<tr class="highlight">
						<td>CNN</td>
						<td>50</td>
						<td>N/A</td>
						<td>0.7</td>
						<td>128</td>
						<td>0.2199</td>
						<td>0.1795</td>
						<td>91.22%</td>
						<td>93.49%</td>
						<td>91.4%</td>
					</tr>
					<tr>
						<td>TCN + CNN</td>
						<td>50</td>
						<td>True</td>
						<td>0.3</td>
						<td>128</td>
						<td>0.0414</td>
						<td>0.0568</td>
						<td>98.39%</td>
						<td>98.47%</td>
						<td>96.3%</td>
					</tr>
					<tr>
						<td>TCN + CNN</td>
						<td>50</td>
						<td>False</td>
						<td>0.3</td>
						<td>128</td>
						<td>0.0472</td>
						<td>0.0514</td>
						<td>98.42%</td>
						<td>98.52%</td>
						<td>95.95%</td>
					</tr>
					<tr>
						<td>TCN + CNN</td>
						<td>50</td>
						<td>N/A</td>
						<td>0.3</td>
						<td>128</td>
						<td>0.0436</td>
						<td>0.0604</td>
						<td>98.48%</td>
						<td>98.15%</td>
						<td>96.3%</td>
					</tr>
					<tr>
						<td>TCN + CNN</td>
						<td>50</td>
						<td>True</td>
						<td>0.3</td>
						<td>8</td>
						<td>0.2875</td>
						<td>0.1612</td>
						<td>90.24%</td>
						<td>94.48%</td>
						<td>94.15%</td>
					</tr>
					<tr>
						<td>TCN + CNN</td>
						<td>50</td>
						<td>True</td>
						<td>0.3</td>
						<td>32</td>
						<td>0.0632</td>
						<td>0.0598</td>
						<td>97.8%</td>
						<td>98.47%</td>
						<td>96.85%</td>
					</tr>
					<tr>
						<td>TCN + CNN</td>
						<td>50</td>
						<td>True</td>
						<td>0.3</td>
						<td>256</td>
						<td>0.0660</td>
						<td>0.0829</td>
						<td>97.84%</td>
						<td>97.67%</td>
						<td>95.5%</td>
					</tr>
					<tr>
						<td>TCN + CNN</td>
						<td>50</td>
						<td>N/A</td>
						<td>0.3</td>
						<td>32</td>
						<td>0.626</td>
						<td>0.0654</td>
						<td>97.84%</td>
						<td>97.92%</td>
						<td>96.7%</td>
					</tr>
					<tr>
						<td>TCN + CNN</td>
						<td>200</td>
						<td>True</td>
						<td>0.3</td>
						<td>32</td>
						<td>0.0165</td>
						<td>0.0437</td>
						<td>99.49%</td>
						<td>98.78%</td>
						<td>96.95%</td>
					</tr>
					<tr>
						<td>TCN + CNN</td>
						<td>200</td>
						<td>N/A</td>
						<td>0.3</td>
						<td>128</td>
						<td>0.0176</td>
						<td>0.0573</td>
						<td>99.38%</td>
						<td>99.07%</td>
						<td>96.95%</td>
					</tr>
					<tr class="highlight">
						<td>TCN + CNN</td>
						<td>200</td>
						<td>N/A</td>
						<td>0.3</td>
						<td>32</td>
						<td>0.0216</td>
						<td>0.0648</td>
						<td>99.27%</td>
						<td>98.74%</td>
						<td>97%</td>
					</tr>
			</table>
			<figcaption><span>Table 4:</span> Results of training the CNN and TCN for arrhythmia prediction.
			* Dropout values are between 0-1, where 0 is no dropout and 1 is 100% dropout.</figcaption>
		</figure>

		<h3>TCN Performance</h3>
		<p>The TCN outperformed the CNN in each experiment.
			When training over 50 epochs with batch size 128, both the model with transferred frozen layers (<a href="#figure12">Figure 12</a>), and the model without transfer learning achieved a high accuracy of 96.3% (see <a href="table4">Table 4</a>).
			Testing different batch sizes revealed that this could be further improved, with a batch size of 32 performing best for both over 50 epochs.
			Then the models were trained over 200 epochs using this batch size.
			The highest test accuracy was impressive at 97% from the TCN without transferred weights.
			However, the performance of the frozen TCN was very similar at 96.95% (see <a href="#figure10">Figure 10</a>) and this model did in fact achieve a significantly lower training and validation loss.
		</p>

		<a name="figure12"></a>
		<figure>
			<p><img class="classifier-train diagram" src="Assets/Images/TCN-Training-Arrhythmia-Transfer.png"></p>
			<figcaption><span>Figure 12:</span> Training the TCN arrhythmia classifier with transfer learning</figcaption>
		</figure>

		<a name="figure13"></a>
		<figure>
			<p><img class="classifier-train diagram" src="Assets/Images/TCN-Training-Arrhythmia.png"></p>
			<figcaption><span>Figure 13:</span> Training the TCN arrhythmia classifier without transfer learning </figcaption>
		</figure>

		<br>

	</div>

	<div>
		<a name="discussions" class="anchor"></a>
		<h1>Discussions and Findings</h1>
		<h2>Project Summary</h2>
		<p>The objective was to create a classifier to detect heart conditions from ECG time-series data.
			To achieve this, several techniques were explored, with focus on developing a semi-supervised strategy.
			The chosen approach involved first applying unsupervised clustering to the data, training a model using the clustered data, and finally applying the model to a supervised problem using transfer learning.
		</p>

		<h3>Clustering</h3>
		<p>After contrasting various clustering techniques, k-means was chosen divide each ECG into 19 clusters.
			To improve cluster distribution, PCA with 15 principal components was applied to each time-series before clustering.
		</p>

		<h3>Cluster Classification</h3>
		<p>Next a classifier was created to predict the newly assigned labels for the clustered data.
			For this model, several design choices needed to be made, such as the network architecture and the best parameters.
			Among the networks considered for our cluster classifier, the most prominent one is TCN, a new state-of-the-art model designed to perform exceptionally well on time-series data, although not previously having been used much on ECG-type data.
			Similarly, other layer variations were tested, such as self-attention layers, which did not positively impact the training outcome and was consequently discarded.
			The experiments suggest that the TCN-CNN architecture is the optimal combination as it not only meets but also exceeds expectations, showing better results than any other candidate model.
		</p>

		<h3>Arrhythmia Classification</h3>
		<p>The final classifier in our solution learns from the original labelled dataset, and transfer learning incorporates the weights of the cluster classifier to improve its performance.
			To assess the performance of our solution, a fully-supervised model using the same architectures (CNN, TCN, LSTM) as the supervised classifier in our semi-supervised approach was also implemented as a point of comparison.
			While the results from both approaches were similar, this demonstrates the potential of our approach, which will stand to benefit in the context of medical imaging, where most data is unlabeled.
		</p>

		<br>

		<h2>Code, Data and Models</h2>
		<p>The ECG time-series data is avaliable from <a href="https://www.kaggle.com/shayanfazeli/heartbeat">Kaggle</a>,
			while the Python notebooks, dataset of ECGs with cluster assignments and trained model weights made in this project are freely avaliable and to download from <a href="https://github.com/TomMakesThings/Semi-Supervised-ECG-Classifier">our GitHub repository</a>.
		</p>

		<br>

		<h2>Future Suggestions</h2>
		<p>To fully flesh out the prospective of our proposed semi-supervised solution, there are several avenues to explore in future work.
			To improve performance, additional efforts can be made to increase the number of training samples, whether through exploring and implementing different augmentation techniques or adapting new datasets to suit our architecture.
			It is also likely that accuracy could be increased further with additional hyperparameter tuning.
		</p>

		<br>

		<h1>Contributions</h1>
		<p>As each group member had different skills and interests, work was divided as follows:</p>
		<ul>
			<li><span>Tom:</span> Team leader, notebook development, website creator, background research and results write up, proposed network diagram</li>
			<li><span>Lavinia:</span> Time series augmentation research, clustering and network optimisation, recording classifier results and graphs</li>
			<li><span>Dave:</span> Clustering research, initial data augmentation experimentation, clustering parameter optimisation, semi-supervised classification experimentation</li>
			<li><span>Will:</span> Network architecture research, DBSCAN optimisation, LSTM experimentation</li>
		</ul>

		<br>

		<h1>References</h1>
		<ul>
			<li>[1] NIH, Arrhythmia. National Heart Lung and Blood Institute. Available at: https://www.nhlbi.nih.gov/health-topics/arrhythmia [Accessed March 21, 2021].</li>
			<li>[2] NHS, Electrocardiogram (ECG). National Health Service. Available at: https://www.nhs.uk/conditions/electrocardiogram/ [Accessed March 24, 2021].</li>
			<li>[3] Luz, E.J.D.S., Schwartz, W.R., Cámara-Chávez, G. and Menotti, D., 2016. ECG-based heartbeat classification for arrhythmia detection: A survey. Computer methods and programs in biomedicine, 127, pp.144-164.</li>
			<li>[4] Moody, G. & Mark, R., 2005. MIT-BIH Arrhythmia Database. MIT-BIH Arrhythmia Database v1.0.0. Available at: https://www.physionet.org/content/mitdb/1.0.0/  [Accessed March 30, 2021].</li>
			<li>[5] Das, M.K. and Ari, S., 2014. ECG beats classification using mixture of features. International scholarly research notices, 2014.</li>
			<li>[6] AliveCor, What is an ECG? AliveCor. Available at: https://www.alivecor.com/education/ecg.html [Accessed March 30, 2021].</li>
			<li>[7] Singh, S., Pandey, S.K., Pawar, U. and Janghel, R.R., 2018. Classification of ECG arrhythmia using recurrent neural networks. Procedia computer science, 132, pp.1290-1297.</li>
			<li>[8] Li, J., Si, Y., Xu, T. and Jiang, S., 2018. Deep convolutional neural network based ECG classification system using information fusion and one-hot encoding techniques. Mathematical Problems in Engineering, 2018.</li>
			<li>[9] Hallström, E., How to Build a Recurrent Neural Network in TensorFlow. KDnuggets. Available at: https://www.kdnuggets.com/2017/04/build-recurrent-neural-network-tensorflow.html [Accessed April 9, 2021].</li>
			<li>[10] Melcher, K., 2018. "Once Upon A Time ... " by LSTM Network. KNIME. Available at: https://www.knime.com/blog/text-generation-with-lstm [Accessed April 9, 2021].</li>
			<li>[11] Esling, P. and Agon, C., 2012. Time-series data mining. ACM Computing Surveys (CSUR), 45(1), pp.1-34.</li>
			<li>[12] Fawaz, H.I., Forestier, G., Weber, J., Idoumghar, L. and Muller, P.A., 2019. Deep learning for time series classification: a review. Data Mining and Knowledge Discovery, 33(4), pp.917-963.</li>
			<li>[13] Wen, Q., Sun, L., Song, X., Gao, J., Wang, X. and Xu, H., 2020. Time series data augmentation for deep learning: A survey. arXiv preprint arXiv:2002.12478.</li>
			<li>[14] Le Guennec, A., Malinowski, S. and Tavenard, R., 2016, September. Data augmentation for time series classification using convolutional neural networks. In ECML/PKDD workshop on advanced analytics and learning on temporal data.</li>
			<li>[15] Pan, S.J. and Yang, Q., 2009. A survey on transfer learning. IEEE Transactions on knowledge and data engineering, 22(10), pp.1345-1359.</li>
			<li>[16] Palacio-Niño, J.O. and Berzal, F., 2019. Evaluation metrics for unsupervised learning algorithms. arXiv preprint arXiv:1905.05667.</li>
			<li>[17] Philippe Remy, keras-tcn. GitHub. Available at: https://github.com/philipperemy/keras-tcn  [Accessed April  23, 2021].</li>
			<li>[18] Isaac Godfried, 2019. Attention for time series forecasting and classification. Available at: https://towardsdatascience.com/attention-for-time-series-classification-and-forecasting-261723e0006d</li>
			<li>[19] P. Sarkar and A. Etemad, 2020. Self-supervised ECG Representation Learning for Emotion Recognition. Available at: https://arxiv.org/pdf/2002.03898.pdf</li>
		<ul>

		<br>

	</div>

	<div>
		<a name="appendix"></a>
		<h1>Appendix</h1>
		<h2>Clustering</h2>
		<h3>K-Means Clustering</h3>
		<p>For k-means, different numbers of clusters were tested to find the optimal number.
			As PCA led to different silhouette coefficients each time, each configuration with principal components was run 20 times and the average silhouette coefficient and standard deviation values recorded in <a href="#table5">Table 5</a>.
			The parameters selected to produce the labels for the cluster classifiers are highlighted yellow.

	<a name="figure14"></a>
	<figure>
		<div class="aligned-images">
			<p><img class="cluster-size diagram" src="Assets/Images/K-Means-Cluster-Size.png"></p>
			<p><img class="cluster-size diagram" src="Assets/Images/K-Means-Cluster-Size.png"></p>
		</div>
		<figcaption><span>Figure 14:</span> Number of samples in k-means clusters without applying PCA (left) and after applying PCA with 25 principal components (right)</figcaption>
	</figure>

	<a name="figure15"></a>
	<figure>
		<p><img class="cluster-tsne diagram" src="Assets/Images/K-Means-t-SNE.png"></p>
		<figcaption><span>Figure 15:</span> t-SNE plot visualising the k-means selected clusters to show how similar clusters are to one another</figcaption>
	</figure>

	<a name="figure16"></a>
	<figure>
		<p><img class="cluster-tsne diagram" src="Assets/Images/K-Means-PCA.png"></p>
		<figcaption><span>Figure 16:</span> : First two principal components of selected clusters.
			Like the t-SNE plot, this shows which clusters are most alike, as well as the size of each cluster.</figcaption>
	</figure>

	<br>

	<a name="table5"></a>
	<figure style="margin: 0px;">
		<table>
			<thead>
				<tr>
					<th>Number of Clusters</th>
					<th>Principal Components</th>
					<th>Silhouette Coefficient</th>
					<th>Standard Deviation (σ)</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td>10</td>
					<td>N/A</td>
					<td>0.1537</td>
					<td>475.48</td>
				</tr>
				<tr>
					<td>11</td>
					<td>N/A</td>
					<td>0.1533</td>
					<td>470.39</td>
				</tr>
				<tr>
					<td>12</td>
					<td>N/A</td>
					<td>0.1609</td>
					<td>489.05</td>
				</tr>
				<tr>
					<td>13</td>
					<td>N/A</td>
					<td>0.1693</td>
					<td>453.25</td>
				</tr>
				<tr>
					<td>14</td>
					<td>N/A</td>
					<td>0.1684</td>
					<td>459.58</td>
				</tr>
				<tr>
					<td>15</td>
					<td>N/A</td>
					<td>0.1675</td>
					<td>433.51</td>
				</tr>
				<tr>
					<td>16</td>
					<td>N/A</td>
					<td>0.1746</td>
					<td>400.89</td>
				</tr>
				<tr>
					<td>17</td>
					<td>N/A</td>
					<td>0.1804</td>
					<td>335.57</td>
				</tr>
				<tr>
					<td>18</td>
					<td>N/A</td>
					<td>0.1796</td>
					<td>320.82</td>
				</tr>
				<tr>
					<td>19</td>
					<td>N/A</td>
					<td>0.1825</td>
					<td>279.0</td>
				</tr>
				<tr>
					<td>20</td>
					<td>N/A</td>
					<td>0.1745</td>
					<td>246.72</td>
				</tr>
				<tr>
					<td>19</td>
					<td>50</td>
					<td>0.1794</td>
					<td>305.14</td>
				</tr>
				<tr>
					<td>19</td>
					<td>30</td>
					<td>0.1972</td>
					<td>290.04</td>
				</tr>
				<tr>
					<td>19</td>
					<td>25</td>
					<td>0.1943</td>
					<td>206.37</td>
				</tr>
				<tr class="highlight">
					<td>19</td>
					<td>15</td>
					<td>0.2472B</td>
					<td>335.03</td>
				</tr>
				<tr>
					<td>19</td>
					<td>5</td>
					<td>0.3185</td>
					<td>406.04</td>
				</tr>
				<tr>
					<td>19</td>
					<td>2</td>
					<td>0.3729</td>
					<td>433.12</td>
				</tr>
				<tr>
					<td>19</td>
					<td>1</td>
					<td>0.5162</td>
					<td>378.23</td>
				</tr>
			</tbody>
		</table>
		<figcaption><span>Table 5:</span> K-means parameter optimization</figcaption>
	</figure>

	<br>

	<h3>Agglomerative Hierarchical Clustering</h3>
	<p>Like k-means, different numbers of clustered were tested and the results documented in <a href="#table6">Table 6</a>.
		This algorithm was not selected to create the labels for the cluster classifier.</p>

	<a name="figure17"></a>
	<figure>
		<div class="aligned-images">
			<p><img class="cluster-size diagram" src="Assets/Images/Hierarchical-Cluster-Size.png"></p>
			<p><img class="cluster-size diagram" src="Assets/Images/Hierarchical-Cluster-Size.png"></p>
		</div>
		<figcaption><span>Figure 17:</span> Number of samples in agglomerative clusters without applying PCA (left) and after applying PCA with 20 principal components (right)</figcaption>
	</figure>

	<a name="figure18"></a>
	<figure>
		<p><img class="cluster-tsne diagram" src="Assets/Images/Hierarchical-t-SNE.png"></p>
		<figcaption><span>Figure 18:</span> t-SNE plot visualising the agglomerative hierarchical clustering selected clusters to show how similar clusters are to one another</figcaption>
	</figure>

	<br>

	<a name="table6"></a>
	<figure style="margin: 0px;">
		<table>
			<thead>
				<tr>
					<th>Number of Clusters</th>
					<th>Principal Components</th>
					<th>Silhouette Coefficient</th>
					<th>Standard Deviation (σ)</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td>10</td>
					<td>N/A</td>
					<td>0.1609</td>
					<td>738.09</td>
				</tr>
				<tr>
					<td>11</td>
					<td>N/A</td>
					<td>0.1554</td>
					<td>627.64</td>
				</tr>
				<tr>
					<td>12</td>
					<td>N/A</td>
					<td>0.1630</td>
					<td>657.01</td>
				</tr>
				<tr>
					<td>13</td>
					<td>N/A</td>
					<td>0.1616</td>
					<td>654.47</td>
				</tr>
				<tr>
					<td>14</td>
					<td>N/A</td>
					<td>0.1641</td>
					<td>556.93</td>
				</tr>
				<tr>
					<td>15</td>
					<td>N/A</td>
					<td>0.1603</td>
					<td>477.62</td>
				</tr>
				<tr>
					<td>16</td>
					<td>N/A</td>
					<td>0.1661</td>
					<td>359.58</td>
				</tr>
				<tr>
					<td>17</td>
					<td>N/A</td>
					<td>0.1661</td>
					<td>335.50</td>
				</tr>
				<tr>
					<td>18</td>
					<td>N/A</td>
					<td>0.1676</td>
					<td>352.99</td>
				</tr>
				<tr>
					<td>19</td>
					<td>N/A</td>
					<td>0.1693</td>
					<td>370.99</td>
				</tr>
				<tr>
					<td>20</td>
					<td>N/A</td>
					<td>0.1640</td>
					<td>342.27</td>
				</tr>
				<tr>
					<td>19</td>
					<td>50</td>
					<td>0.1804</td>
					<td>351.66</td>
				</tr>
				<tr>
					<td>19</td>
					<td>20</td>
					<td>0.2116</td>
					<td>352.02</td>
				</tr>
				<tr>
					<td>19</td>
					<td>5</td>
					<td>0.2727</td>
					<td>365.59</td>
				</tr>
			</tbody>
		</table>
		<figcaption><span>Table 6:</span> Agglomerative clustering parameter optimization</figcaption>
	</figure>

	<h3>DBSCAN Clustering</h3>
	<p>For DBSCAN, parameters epsilon and minimum point were tested, and the results documented in <a href="#table7">Table 7</a>.</p>

	<a name="figure19"></a>
	<figure>
		<p><img class="cluster-tsne diagram" src="Assets/Images/DBSCAN-PCA.png"></p>
		<figcaption><span>Figure 19:</span> First two principal components of DBSCAN clusters.
			This shows how many ECGs are not being clustered (-1), and how a lot of the clusters contain very few samples.</figcaption>
	</figure>

	<br>

	<a name="table7"></a>
	<figure style="margin: 0px;">
		<table>
			<thead>
				<tr>
					<th>Epsilon (ε)</th>
					<th>Minimum Points</th>
					<th>Principal Components</th>
					<th>Silhouette Coefficient</th>
					<th>Number of Clusters</th>
					<th>Number Unclustered</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td>0.5 (default)</td>
					<td>5 (default)</td>
					<td>70</td>
					<td>-0.26928</td>
					<td>168</td>
					<td>7175</td>
				</tr>
				<tr>
					<td>0.3</td>
					<td>5</td>
					<td>N/A</td>
					<td>-0.41287</td>
					<td>78</td>
					<td>9798</td>
				</tr>
				<tr>
					<td>0.3</td>
					<td>16</td>
					<td>N/A</td>
					<td>-0.11727</td>
					<td>33</td>
					<td>4560</td>
				</tr>
				<tr>
					<td>0.7</td>
					<td>5</td>
					<td>70</td>
					<td>-0.12748</td>
					<td>129</td>
					<td>3611</td>
				</tr>
				<tr>
					<td>0.</td>
					<td>5</td>
					<td>70</td>
					<td>B</td>
					<td>B</td>
					<td>B</td>
				</tr>
				<tr>
					<td>0.7</td>
					<td>8</td>
					<td>70</td>
					<td>-0.08927</td>
					<td>75</td>
					<td>4511</td>
				</tr>
				<tr>
					<td>0.7</td>
					<td>16</td>
					<td>70</td>
					<td>-0.08875</td>
					<td>32</td>
					<td>6001</td>
				</tr>
				<tr>
					<td>0.9</td>
					<td>5</td>
					<td>70</td>
					<td>-0.23484</td>
					<td>85</td>
					<td>2162</td>
				</tr>
				<tr>
					<td>0.9</td>
					<td>8</td>
					<td>70</td>
					<td>-0.21898</td>
					<td>44</td>
					<td>2761</td>
				</tr>
				<tr>
					<td>0.9</td>
					<td>16</td>
					<td>70</td>
					<td>-0.1172</td>
					<td>33</td>
					<td>4560</td>
				</tr>
			</tbody>
		</table>
		<figcaption><span>Table 7:</span> DBSCAN parameter optimization</figcaption>
	</figure>

	<br>

	<h2>Classifiers</h2>
	<h3>Bidirectional LSTM Cluster Classifier</h3>
	<p>Variations of the bidirectional LSTM were trained both with and without the TCN layer and self-attention to predict the cluster labels of each ECG and the results documented in <a href="#table8">Table 8</a>.</p>

	<a name="table8"></a>
	<figure style="margin: 0px;">
		<table>
			<thead>
				<tr>
					<th>Architecture</th>
					<th>Learning Rate (θ)</th>
					<th>AMSGrad</th>
					<th>Batch Normalisation</th>
					<th>Train Loss</th>
					<th>Validation Loss</th>
					<th>Train Accuracy</th>
					<th>Validation Accuracy</th>
					<th>Test Accuracy</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td>BiLSTM</td>
					<td>0.001</td>
					<td>False</td>
					<td>False</td>
					<td>2.3956</td>
					<td>2.8946</td>
					<td>23.96%</td>
					<td>15.28%</td>
					<td>8.35%</td>
				</tr>
				<tr>
					<td>BiLSTM</td>
					<td>0.001</td>
					<td>False</td>
					<td>True</td>
					<td>2.7506</td>
					<td>2.9333</td>
					<td>13.68%</td>
					<td>10.2%</td>
					<td>7.85%</td>
				</tr>
				<tr>
					<td>BiLSTM</td>
					<td>0.01</td>
					<td>False</td>
					<td>False</td>
					<td>2.9066</td>
					<td>3.0084</td>
					<td>6.86%</td>
					<td>0.82%</td>
					<td>8.1%</td>
				</tr>
				<tr>
					<td>BiLSTM</td>
					<td>0.001</td>
					<td>True</td>
					<td>False</td>
					<td>2.4135</td>
					<td>2.8414</td>
					<td>23.24%</td>
					<td>16.39%</td>
					<td>8.6%</td>
				</tr>
				<tr>
					<td>TCN + BiLSTM</td>
					<td>0.001</td>
					<td>False</td>
					<td>False</td>
					<td>2.5949</td>
					<td>2.8950</td>
					<td>18.55%</td>
					<td>12.98%</td>
					<td>7.75%</td>
				</tr>
				<tr>
					<td>BiLSTM + self-attention</td>
					<td>0.001</td>
					<td>False</td>
					<td>False</td>
					<td>2.9072</td>
					<td>3.0014</td>
					<td>6.8%</td>
					<td>1.5%</td>
					<td>8.55%</td>
				</tr>
			</tbody>
		</table>
		<figcaption><span>Table 8:</span> Bidirectional LSTM cluster classifier training and testing results</figcaption>
	</figure>

	<h3>CNN Cluster Classifier</h3>
	<p>Variations of the CNN were trained both with and without the TCN layer and self-attention to predict the cluster labels of each ECG and the results documented in <a href="#table9">Table 9</a>.</p>

	<a name="table9"></a>
	<figure style="margin: 0px;">
		<table>
			<thead>
				<tr>
					<th>Architecture</th>
					<th>Learning Rate (θ)</th>
					<th>AMSGrad</th>
					<th>Batch Normalisation</th>
					<th>Train Loss</th>
					<th>Validation Loss</th>
					<th>Train Accuracy</th>
					<th>Validation Accuracy</th>
					<th>Test Accuracy</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td>CNN</td>
					<td>0.001</td>
					<td>False</td>
					<td>False</td>
					<td>2.6842</td>
					<td>2.9459</td>
					<td>13.74%</td>
					<td>8.01%</td>
					<td>6.7%</td>
				</tr>
				<tr>
					<td>CNN</td>
					<td>0.001</td>
					<td>False</td>
					<td>True</td>
					<td>0.8245</td>
					<td>4.2888</td>
					<td>74.78%</td>
					<td>23.92%</td>
					<td>9.95%</td>
				</tr>
				<tr>
					<td>CNN</td>
					<td>0.01</td>
					<td>False</td>
					<td>True</td>
					<td>0.8000</td>
					<td>5.5327</td>
					<td>74.75%</td>
					<td>24.77%</td>
					<td>11.1%</td>
				</tr>
				<tr>
					<td>CNN</td>
					<td>0.001</td>
					<td>True</td>
					<td>True</td>
					<td>0.7387</td>
					<td>4.2511</td>
					<td>77.35%</td>
					<td>23.74%</td>
					<td>10.05%</td>
				</tr>
				<tr>
					<td>TCN + CNN</td>
					<td>0.001</td>
					<td>False</td>
					<td>False</td>
					<td>2.9057</td>
					<td>3.0054</td>
					<td>7.13%</td>
					<td>0.82%</td>
					<td>8.05%</td>
				</tr>
				<tr>
					<td>TCN + CNN</td>
					<td>0.001</td>
					<td>False</td>
					<td>True</td>
					<td>1.0128</td>
					<td>3.2032</td>
					<td>68.32%</td>
					<td>29.9%</td>
					<td>12.85%</td>
				</tr>
				<tr>
					<td>TCN + CNN</td>
					<td>0.01</td>
					<td>False</td>
					<td>True</td>
					<td>1.5354</td>
					<td>3.2391</td>
					<td>51.2%</td>
					<td>25.03%</td>
					<td>11.55%</td>
				</tr>
				<tr>
					<td>TCN + CNN</td>
					<td>0.001</td>
					<td>True</td>
					<td>True</td>
					<td>1.0634</td>
					<td>3.2680</td>
					<td>66.91%</td>
					<td>28.21%</td>
					<td>12.85%</td>
				</tr>
				<tr>
					<td>CNN + self-attention</td>
					<td>0.001</td>
					<td>False</td>
					<td>False</td>
					<td>2.8974</td>
					<td>2.9724</td>
					<td>7.4%</td>
					<td>5.82%</td>
					<td>8.5%</td>
				</tr>
				<tr>
					<td>CNN + self-attention</td>
					<td>0.001</td>
					<td>False</td>
					<td>True</td>
					<td>2.4908</td>
					<td>3.1187</td>
					<td>23.39%</td>
					<td>11.66%</td>
					<td>6.95%</td>
				</tr>
				<tr>
					<td>CNN + self-attention</td>
					<td>0.01</td>
					<td>False</td>
					<td>False</td>
					<td>2.9067</td>
					<td>3.0094</td>
					<td>6.81%</td>
					<td>0.82%</td>
					<td>8.1%</td>
				</tr>
				<tr>
					<td>CNN + self-attention</td>
					<td>0.001</td>
					<td>True</td>
					<td>False</td>
					<td>2.9026</td>
					<td>2.9693</td>
					<td>7.13%</td>
					<td>3.3%</td>
					<td>7.55%</td>
				</tr>
			</tbody>
		</table>
		<figcaption><span>Table 9:</span> CNN cluster classifier training and testing results</figcaption>
	</figure>

	<br>

	<h3>F-Fold Cross Validation</h3>
	<p>Before training the final cluster classifiers in <a href="#table2">Table 2</a>, 5-fold cross validation was run over 15 epochs to find the best train-validation splits for the CNN and TCN-CNN models.
		For both (<a href="#table10">Table 10</a> and <a href="#table11">11</a>), fold 3 performed best achieving 2.9282 and 2.9281 loss retrospectively.</p>

		<a name="table10"></a>
		<figure style="margin: 0px;">
			<table>
				<thead>
					<tr>
						<th>Fold</th>
						<th>Train Loss</th>
						<th>Validation Loss</th>
						<th>Train Accuracy</th>
						<th>Validation Accuracy</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td>1</td>
						<td>2.9220</td>
						<td>2.9285</td>
						<td>6.44%</td>
						<td>4.66%</td>
					</tr>
					<tr>
						<td>2</td>
						<td>2.9233</td>
						<td>2.9347</td>
						<td>6.48%</td>
						<td>4.66%</td>
					</tr>
					<tr>
						<td>3</td>
						<td>2.9220</td>
						<td>2.9282</td>
						<td>6.48%</td>
						<td>4.69%</td>
					</tr>
					<tr>
						<td>4</td>
						<td>2.9128</td>
						<td>2.9768</td>
						<td>6.63%</td>
						<td>1.12%</td>
					</tr>
					<tr>
						<td>5</td>
						<td>2.9109</td>
						<td>2.9870</td>
						<td>6.75%</td>
						<td>0.76%</td>
					</tr>
				</tbody>
			</table>
			<figcaption><span>Table 10:</span> Results of 5-fold cross validation for the optimised CNN cluster classifier</figcaption>
		</figure>

		<br>

		<a name="table11"></a>
		<figure style="margin: 0px;">
			<table>
				<thead>
					<tr>
						<th>Fold</th>
						<th>Train Loss</th>
						<th>Validation Loss</th>
						<th>Train Accuracy</th>
						<th>Validation Accuracy</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td>1</td>
						<td>2.9220</td>
						<td>2.9285</td>
						<td>6.44%</td>
						<td>4.66%</td>
					</tr>
					<tr>
						<td>2</td>
						<td>2.9233</td>
						<td>2.9347</td>
						<td>6.48%</td>
						<td>4.66%</td>
					</tr>
					<tr>
						<td>3</td>
						<td>2.9220</td>
						<td>2.9282</td>
						<td>6.48%</td>
						<td>4.69%</td>
					</tr>
					<tr>
						<td>4</td>
						<td>2.9128</td>
						<td>2.9768</td>
						<td>6.63%</td>
						<td>1.12%</td>
					</tr>
					<tr>
						<td>5</td>
						<td>2.9109</td>
						<td>2.9870</td>
						<td>6.75%</td>
						<td>0.76%</td>
					</tr>
				</tbody>
			</table>
			<figcaption><span>Table 11:</span> Results of 5-fold cross validation for the optimised TCN cluster classifier</figcaption>
		</figure>

	</div>

	<br>
	<br>
	<br>

</div>

<div class="footer">
	<div class="footer-center">
		<a href="https://github.com/TomMakesThings">&copy; TomMakesThings <script>document.write(new Date().getUTCFullYear());</script></a>
	</div>
</div>

<script src="Javascript/navbar.js"></script>

</body>
</html>
